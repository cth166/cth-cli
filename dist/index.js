"use strict";var e=require("commander"),t=require("node:fs/promises"),n=require("node:util"),o=require("node:child_process"),i=require("node:fs"),r=require("node:path"),s=require("node:url"),a=require("ejs"),c="undefined"!=typeof document?document.currentScript:null;const m=n.promisify(require("download-git-repo")),u=n.promisify(o.exec);async function d(e,t,n,o){e?await async function(e,t,n){await u(`git clone -b ${t} https://gitee.com/${e}.git ${n}`)}(t,n,o):(await async function(e,t){await m(e,t,{clone:!0})}(`${t}#${n}`,o),await u(`cd ${o} && git init`))}function l(e){return e.charAt(0).toUpperCase()+e.slice(1)}const p=s.fileURLToPath("undefined"==typeof document?require("url").pathToFileURL(__filename).href:c&&c.src||new URL("index.js",document.baseURI).href),f=r.dirname(p);function w(e,t){const n=r.resolve(f,`../src/ejs-templates/${e}.ejs`),o=l(t);return new Promise(((e,i)=>{a.renderFile(n,{name:t,capitalizeInitialName:o},((t,n)=>{t?i(t):e(n)}))}))}async function g({filePath:e,content:n}){const o=await t.open(e,"r+"),i=await o.stat();o.createWriteStream({start:i.size}).write(n)}var y=Object.freeze({__proto__:null,addCommands:function(){$.command("add").argument("<model_name>","a model name").description("add a table and a easy router").action((async function(e){var t;console.log(`add ${e} success`);const n=l(e=(t=e).charAt(0).toLowerCase()+t.slice(1)),o=await w("model",e);i.writeFileSync(`src/db/models/${n}.ts`,o);const r=await w("router",e);i.writeFileSync(`src/routers/${e}.ts`,r),g({filePath:"src/db/models/index.ts",content:`export { ${n} } from "./${n}";\n`}),g({filePath:"src/routers/subRouters.ts",content:`export { ${e}_router as ${e} } from './${e}';\n`})}))},globalOptions:function(){$.option("--gitee","download initial template from gitee")},initCommands:function(){$.command("init").argument("[project_name]","a project name","cth-backend").argument("[project_type]","use ts or js","ts").description("init a back-end project").action((async function(e,n){const o=$.opts();let i="main";"testdemo"===e&&(i="testdemo");try{await d(o.gitee,"cth166/sqts-template",i,e),await async function(e){const n=`${e}/package.json`,o=(await t.readFile(n,"utf-8")).split("\n");o[1]=o[1].replace("sqts-template",e);const i=o.join("\n");await t.writeFile(n,i,"utf-8")}(e),function(e){process.stdout.write("[32m[1minit success![0m\n"),process.stdout.write(`cd ./${e} Then you can run:ðŸ‘‡\n`),process.stdout.write("[36m[1mpnpm i[0m\n"),process.stdout.write("[32m[1mMore scripts in package.json.[0m\n"),process.stdout.write("[32m[1mHappy Coding!ðŸ˜€[0m\n")}(e)}catch(e){console.log(e)}}))}});const $=new e.Command;$.version(require("../package.json").version);for(const[e,t]of Object.entries(y))t();$.parse(),module.exports=$;
